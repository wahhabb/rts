{% extends parent_template|default:"comix/base_comix.html" %}

{% block title %}
{{ block.super }} - Comic List
{% endblock %}

{% block sectionhead %}
    <section id="list" class="columns">
{% endblock %}
{% block subcontent %}
    {% load static %}
        <div class="column col-9 issue">
        {% if genre_text != None %}
            <h3>Category: {{ genre_text }}</h3>
        {% elif publisher_name != None %}
            <h3>Publisher: {{ publisher_name }}</h3>
        {% endif %}
{#        <h3>{{ request.session.per_page }} per page</h3>#}
            <label for="per_page">Show per page:</label>
             <select id="per_page" onchange="perPage(value);">
                <option value="9">9</option>
                <option value="30" {% if request.session.per_page == '30' %} selected="selected" {% endif %}
                >30</option>
                <option value="99"  {% if request.session.per_page == '99' %} selected="selected" {% endif %}
                >99 (List format)</option>
            </select>
       <form id="sortorder" action="">
            <span>Sort Order: &nbsp;</span>
            <input type="radio" {% if sort_order == 'alpha'  or sort_order == None %}  checked {% endif %}
                   onclick="sortby('alpha')" name="sort" value="alpha" id="alpha">&nbsp;Alphabetically &nbsp;
            <input type="radio" {% if sort_order == 'price-down'%}  checked {% endif %}
                   onclick="sortby('price-down')" name="sort" value="-price" id="price-down"> Price High to Low &nbsp;
            <input type="radio" {% if sort_order == 'price-up' %}  checked {% endif %}
                   onclick="sortby('price-up')" name="sort" value="price" id="price-up"> Price Low to High &nbsp;
        </form>
        {% if request.session.per_page == '99' %}
            {% include 'comix/issue_list_list.html' %}
        {% else %}
            {% include 'comix/issue_list_items.html' %}
        {% endif %}
        </div>
        </div>

   <!--
    indicia_date = models.CharField(max_length=255)
    inserts = models.CharField(max_length=255)
    si = models.CharField(max_length=255)
    added_date = models.DateTimeField()
    tags = models.ManyToManyField(Tag)
    quantity = models.IntegerField()
    status = models.CharField(max_length=63)
    sold_date = models.DateTimeField(null=True)
    -->

    </section>
    {% if is_paginated %}
        <div class="center-text">
        <ul class="pagination">
            {% if issues.has_previous %}
            <li>
                <a href="?page={{ issues.previous_page_number }}{{ query_string }}">Previous</a>
            </li>
            {% endif %}
             <li>
                Page {{ issues.number }} of {{ paginator.num_pages }}
            </li>
            {% if issues.has_next %}
            <li>
                <a href="?page={{ issues.next_page_number }}{{ query_string }}">Next</a>
            </li>
                <li>
                Go to page: <input type="number" id="gotopage">
                    <a onclick="window.location = '?page=' + getElementById('gotopage').value + '{{ query_string }}';return 0;" class="btn btn-sm">Go</a>
                </li>
            {% endif %}
        </ul>
        </div>
    {% endif %}

{#        Display message if duplicate add to cart of single item    #}
    <div id="already_in_cart">Already in Cart<br>Not Added</div>
    <div id="added_to_cart">Added to Cart</div>

    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script>
        $(function() {
            $('#search_block').show();
            $("#title_search").autocomplete({
                source: "/get-titles/",
                minLength: 2
            });
            $('.ui-widget').click(function () {
                setTimeout(dosearch, 200);
            });
        });
        function perPage(count) {
        $.post('/update_session/', {count: count}, function(data) {
            var qs = "{{ query_string|safe }}";
            window.location = '?page=1' + qs;
{#            window.location = '?{% query_transform request page=1 %}';#}

        })
            .fail(function () {
                alert('fail');
            });
        }
        function sortby(order) {
            prev_order = order;
            var qs = "{{ query_string|safe }}";
            if (qs.search(/(.+)&sort=.+(&*.*)/) > -1) {
                window.location = '?page=1' + qs.replace(/(.+)&sort=[^&]+(.*)/, '$1&sort=' + order);
            } else {
                window.location = '?page=1' + qs + '&sort=' + order;
            }
        }

    </script>
{% endblock %}